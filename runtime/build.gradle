import org.jetbrains.kotlin.CompileCppToBitcode

// TODO: consider using some Gradle plugins to build and test


task build(type: CompileCppToBitcode) {
    name 'runtime'
    srcRoot file('src/main')

    dependsOn ':common:compileHash'
    dependsOn 'launcher'
    compilerArgs '-I' + project.file('../common/src/hash/headers') // TODO: copy-pasted from 'common'
    linkerArgs project.file('../common/build/hash.bc').path
}

task launcher(type: CompileCppToBitcode) {
    name 'launcher'
    srcRoot file('src/launcher')
    compilerArgs '-I' + project.file('../common/src/hash/headers') // TODO: copy-pasted from 'common'
    compilerArgs '-I' + project.file('src/main/cpp')
}

task clean << {
    delete buildDir
}
