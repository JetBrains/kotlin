/*
 * Copyright 2010-2025 JetBrains s.r.o. and Kotlin Programming Language contributors.
 * Use of this source code is governed by the Apache 2.0 license that can be found in the license/LICENSE.txt file.
 */

package org.jetbrains.kotlin.arguments.description

import org.jetbrains.kotlin.arguments.dsl.base.*
import org.jetbrains.kotlin.arguments.dsl.defaultFalse
import org.jetbrains.kotlin.arguments.dsl.defaultNull
import org.jetbrains.kotlin.arguments.dsl.types.BooleanType
import org.jetbrains.kotlin.arguments.dsl.types.StringType
import org.jetbrains.kotlin.cli.common.arguments.Enables
import org.jetbrains.kotlin.config.LanguageFeature

val actualJsArguments by compilerArgumentsLevel(CompilerArgumentsLevelNames.jsArguments) {

    compilerArgument {
        name = "target"
        description = "Generate JS files for the specified ECMA version.".asReleaseDependent()
        valueType = StringType.defaultNull
        valueDescription = "{ es5, es2015 }".asReleaseDependent()

        lifecycle(
            introducedVersion = KotlinReleaseVersion.v1_0_0,
            stabilizedVersion = KotlinReleaseVersion.v1_0_0,
        )
    }

    compilerArgument {
        name = "Xir-keep"
        description = "Comma-separated list of fully qualified names not to be eliminated by DCE (if it can be reached), and for which to keep non-minified names.".asReleaseDependent()
        valueType = StringType.defaultNull

        lifecycle(
            introducedVersion = KotlinReleaseVersion.v1_8_20,
        )
    }

    compilerArgument {
        name = "module-kind"
        description = "The kind of JS module generated by the compiler. ES modules are enabled by default in case of ES2015 target usage".asReleaseDependent()
        valueType = StringType.defaultNull
        valueDescription = "{plain|amd|commonjs|umd|es}".asReleaseDependent()

        lifecycle(
            introducedVersion = KotlinReleaseVersion.v1_0_4,
            stabilizedVersion = KotlinReleaseVersion.v1_0_4,
        )
    }

    // Advanced options

    compilerArgument {
        name = "Xir-minimized-member-names"
        description = "Minimize the names of members.".asReleaseDependent()
        valueType = BooleanType.defaultFalse

        lifecycle(
            introducedVersion = KotlinReleaseVersion.v1_7_0,
        )
    }

    compilerArgument {
        name = "Xir-safe-external-boolean"
        description = "Wrap access to external 'Boolean' properties with an explicit conversion to 'Boolean'.".asReleaseDependent()
        valueType = BooleanType.defaultFalse

        lifecycle(
            introducedVersion = KotlinReleaseVersion.v1_5_30
        )
    }

    compilerArgument {
        name = "Xir-safe-external-boolean-diagnostic"
        description = "Enable runtime diagnostics when accessing external 'Boolean' properties.".asReleaseDependent()
        valueType = StringType.defaultNull
        valueDescription = "{log|exception}".asReleaseDependent()

        lifecycle(
            introducedVersion = KotlinReleaseVersion.v1_5_30,
        )
    }

    compilerArgument {
        name = "Xir-generate-inline-anonymous-functions"
        description = "Lambda expressions that capture values are translated into in-line anonymous JavaScript functions.".asReleaseDependent()
        valueType = BooleanType.defaultFalse

        lifecycle(
            introducedVersion = KotlinReleaseVersion.v1_7_20,
        )
    }

    compilerArgument {
        name = "Xir-build-cache"
        description = "Use the compiler to build the cache.".asReleaseDependent()
        valueType = BooleanType.defaultFalse

        lifecycle(
            introducedVersion = KotlinReleaseVersion.v1_5_30,
        )
    }

    compilerArgument {
        name = "Xgenerate-polyfills"
        description = "Generate polyfills for features from the ES6+ standards.".asReleaseDependent()
        valueType = BooleanType(
            isNullable = false.asReleaseDependent(),
            defaultValue = true.asReleaseDependent()
        )

        lifecycle(
            introducedVersion = KotlinReleaseVersion.v1_8_20,
        )
    }

    compilerArgument {
        name = "Xes-classes"
        compilerName = "useEsClasses"
        description = "Let generated JavaScript code use ES2015 classes. Enabled by default in case of ES2015 target usage".asReleaseDependent()
        valueType = BooleanType.defaultNull

        lifecycle(
            introducedVersion = KotlinReleaseVersion.v1_8_20,
        )
    }

    compilerArgument {
        name = "Xplatform-arguments-in-main-function"
        compilerName = "platformArgumentsProviderJsExpression"
        description = "JS expression that will be executed in runtime and be put as an Array<String> parameter of the main function".asReleaseDependent()
        valueType = StringType.defaultNull

        lifecycle(
            introducedVersion = KotlinReleaseVersion.v2_0_0,
        )
    }

    compilerArgument {
        name = "Xes-generators"
        compilerName = "useEsGenerators"
        description = "Enable ES2015 generator functions usage inside the compiled code. Enabled by default in case of ES2015 target usage".asReleaseDependent()
        valueType = BooleanType.defaultNull

        lifecycle(
            introducedVersion = KotlinReleaseVersion.v2_0_0,
        )
    }

    compilerArgument {
        name = "Xes-arrow-functions"
        compilerName = "useEsArrowFunctions"
        description = "Use ES2015 arrow functions in the JavaScript code generated for Kotlin lambdas. Enabled by default in case of ES2015 target usage".asReleaseDependent()
        valueType = BooleanType.defaultNull

        lifecycle(
            introducedVersion = KotlinReleaseVersion.v2_1_0,
        )
    }

    compilerArgument {
        name = "Xes-long-as-bigint"
        compilerName = "compileLongAsBigInt"
        description = "Compile Long values as ES2020 bigint instead of object.".asReleaseDependent()
        valueType = BooleanType.defaultNull

        lifecycle(
            introducedVersion = KotlinReleaseVersion.v2_2_20,
        )
    }

    compilerArgument {
        name = "Xenable-extension-functions-in-externals"
        compilerName = "extensionFunctionsInExternals"
        description = "Enable extension function members in external interfaces.".asReleaseDependent()
        valueType = BooleanType.defaultFalse
        additionalAnnotations(Enables(LanguageFeature.JsEnableExtensionFunctionInExternals))

        lifecycle(
            introducedVersion = KotlinReleaseVersion.v1_5_32,
        )
    }

    compilerArgument {
        name = "Xenable-suspend-function-exporting"
        compilerName = "allowExportingSuspendFunctions"
        description = "Enable exporting suspend functions to JavaScript/TypeScript.".asReleaseDependent()
        valueType = BooleanType.defaultFalse
        additionalAnnotations(Enables(LanguageFeature.JsAllowExportingSuspendFunctions))

        lifecycle(
            introducedVersion = KotlinReleaseVersion.v2_3_0,
        )
    }

    compilerArgument {
        name = "Xenable-implementing-interfaces-from-typescript"
        compilerName = "allowImplementableInterfacesExporting"
        description = "Enable exporting of Kotlin interfaces to implement them from JavaScript/TypeScript.".asReleaseDependent()
        valueType = BooleanType.defaultFalse
        additionalAnnotations(Enables(LanguageFeature.JsExportInterfacesInImplementableWay))

        lifecycle(
            introducedVersion = KotlinReleaseVersion.v2_3_20,
        )
    }

    compilerArgument {
        name = "Xoptimize-generated-js"
        description = "Perform additional optimizations on the generated JS code.".asReleaseDependent()
        valueType = BooleanType(
            isNullable = false.asReleaseDependent(),
            defaultValue = true.asReleaseDependent()
        )

        lifecycle(
            introducedVersion = KotlinReleaseVersion.v1_9_0,
        )
    }
}
