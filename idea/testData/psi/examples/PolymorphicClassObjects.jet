virtual class Builder<E, R> {
  [operator] fun plusAssign(item : E)
  fun result() : R
}

virtual class Buildable {
  fun newBuilder<E, R>() : Builder<E, R>
}

class List<T> {

  class object : Buildable {
    override fun newBuilder<E, R>() : Builder<E, R>

  }

}

fun <E, T, R> where
  T : Iterable<E>,
  class object T : Buildable<E, T> Map<E, T>.map(f : fun (E) : R) : T<R> = {
  val builder = T.newBuilder()
  for (e in this) {
    builder += f(e)
  }
  builder.result()
}